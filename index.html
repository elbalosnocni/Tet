<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Táº¾T GIA Tá»˜C Há»Œ TRÆ¯Æ NG 2026</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
text-align:center;
background:linear-gradient(135deg,#a8edea,#fed6e3);
}

h1{margin-top:20px;}

.panel{
background:white;
padding:15px;
border-radius:15px;
max-width:600px;
margin:15px auto;
box-shadow:0 0 15px rgba(0,0,0,0.1);
}

button{
padding:10px 20px;
font-size:18px;
border:none;
border-radius:10px;
background:#00b894;
color:white;
cursor:pointer;
margin:5px;
}

button:hover{opacity:0.9;}

#wheel{
width:320px;
height:320px;
margin:20px auto;
border-radius:50%;
border:10px solid #f1c40f;
position:relative;
transition: transform 4s cubic-bezier(.17,.67,.83,.67);
background:conic-gradient(
#ffeaa7 0deg 60deg,
#fab1a0 60deg 120deg,
#ffeaa7 120deg 180deg,
#fab1a0 180deg 240deg,
#ffeaa7 240deg 300deg,
#fab1a0 300deg 360deg
);
}

.pointer{
position:absolute;
top:-15px;
left:50%;
transform:translateX(-50%);
font-size:28px;
}

@media(max-width:500px){
#wheel{
width:280px;
height:280px;
}
}

@keyframes shake {
  0%{transform:translateX(0)}
  25%{transform:translateX(-5px)}
  50%{transform:translateX(5px)}
  75%{transform:translateX(-5px)}
  100%{transform:translateX(0)}
}
  
</style>
</head>

<body>

<h1>ğŸ§§ Táº¾T GIA Tá»˜C Há»Œ TRÆ¯Æ NG 2026 ğŸ§§</h1>

<div class="panel" id="qrPanel">
  ğŸ’° NgÃ¢n sÃ¡ch cÃ²n: <b id="budget">3.000.000</b> Ä‘
  <div id="qr"></div>
</div>

<input type="text" id="name" placeholder="Nháº­p tÃªn"><br>
<button id="spinBtn" onclick="spin()">QUAY NGAY</button>
<button onclick="resetGame()">RESET</button>

<div style="position:relative;">
<div id="wheel"></div>
<div class="pointer">ğŸ”»</div>
<div id="fullNotice" style="display:none; font-weight:bold; color:red; margin-top:10px;">
ğŸ‰ ÄÃ£ Ä‘á»§ 10 ngÆ°á»i tham gia ğŸ‰
</div>

<div class="panel">
<h3>ğŸ† Báº£ng xáº¿p háº¡ng</h3>
<div id="ranking"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyAChGYSzBmFDm5QV0y2KvYqAZlt144zZxg",
authDomain: "tet-gia-toc-ho-truong.firebaseapp.com",
projectId: "tet-gia-toc-ho-truong",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const prizes=[
{text:"500k",value:500000},
{text:"200k",value:200000},
{text:"100k",value:100000},
{text:"50k",value:50000},
{text:"20k",value:20000},
{text:"ChÃºc may máº¯n",value:0}
];

const totalBudget=3000000;
const gameRef=db.collection("game").doc("main");
const wheel=document.getElementById("wheel");

let currentRotation=0;
const resetPassword="vtc"; 
let fullTriggered = false;

/* váº½ chá»¯ */
/* váº½ chá»¯ náº±m Ä‘Ãºng giá»¯a tam giÃ¡c */
window.onload = function(){
const wheelSize = wheel.offsetWidth;
const radius = wheelSize / 2;
const textRadius = radius * 0.55; // 55% lÃ  cÃ¢n nháº¥t

prizes.forEach((p, i) => {

  const angle = i * 60 + 30;

  const label = document.createElement("div");
  label.style.position = "absolute";
  label.style.left = "50%";
  label.style.top = "50%";
  label.style.width = "100px";
  label.style.marginLeft = "-50px";
  label.style.marginTop = "-12px";
  label.style.textAlign = "center";
  label.style.fontWeight = "bold";
  label.style.fontSize = "15px";
  label.style.pointerEvents = "none";
  label.style.color = "#b30000";
  label.style.textShadow = "1px 1px 2px #fff";

  if (p.text === "500k") {
  label.style.color = "#c0392b";        // Ä‘á» Ä‘áº­m
  label.style.fontSize = "20px";
  label.style.fontWeight = "900";
  label.style.textShadow = "2px 2px 0 gold";
}

  label.style.transform =
  `rotate(${angle}deg) translateY(-${textRadius}px) rotate(-${angle}deg)`;

  label.innerText = p.text;
  wheel.appendChild(label);
});
};

/* init */
async function init(){
const snap=await gameRef.get();
if(!snap.exists){
await gameRef.set({
budget:totalBudget,
players:{},
specialCount:0
});
}
}
init();

/* realtime */
gameRef.onSnapshot((docSnap)=>{
if(!docSnap.exists) return;
const data=docSnap.data();

const playerCount = Object.keys(data.players).length;
const qrPanel = document.getElementById("qrPanel");
const notice = document.getElementById("fullNotice");
const spinBtn = document.getElementById("spinBtn");  

  if (playerCount === 10 && !fullTriggered) {
  fullTriggered = true;
  spinBtn.style.animation = "none";
void spinBtn.offsetWidth; // reset animation  
  spinBtn.style.animation = "shake 0.5s";
}
  
if (playerCount >= 10) {
  qrPanel.style.display = "none";
  notice.style.display = "block";
  spinBtn.disabled = true;
  spinBtn.innerText = "ÄÃƒ Äá»¦ 10 NGÆ¯á»œI";
  spinBtn.style.background = "#999";
  spinBtn.style.cursor = "not-allowed";
} else {
  qrPanel.style.display = "block";
  notice.style.display = "none";
  spinBtn.disabled = false;
  spinBtn.innerText = "QUAY NGAY";
  spinBtn.style.background = "#00b894";
  spinBtn.style.cursor = "pointer";
}

document.getElementById("budget").innerText=
data.budget.toLocaleString();

let rankHTML="";
Object.entries(data.players)
.sort((a,b)=>b[1]-a[1])
.forEach(([name,value])=>{
rankHTML+=`<div>${name}: ${value.toLocaleString()} Ä‘</div>`;
});
document.getElementById("ranking").innerHTML=rankHTML;
});

/* spin */
async function spin(){

const btn=document.getElementById("spinBtn");
btn.disabled=true;

const name=document.getElementById("name").value.trim();
if(!name){
btn.disabled=false;
return alert("Nháº­p tÃªn!");
}

try{
await db.runTransaction(async (transaction)=>{
const snap=await transaction.get(gameRef);
const data=snap.data();

if(Object.keys(data.players).length>=10)
throw "Äá»§ 10 ngÆ°á»i rá»“i!";

if(data.players[name]!==undefined)
throw "TÃªn Ä‘Ã£ quay!";

let available=prizes.filter(p=>{
if(p.value>data.budget) return false;
if(p.value==500000 && data.specialCount>=1) return false;
return true;
});

if(available.length==0)
throw "Háº¿t ngÃ¢n sÃ¡ch!";

let prize=available[Math.floor(Math.random()*available.length)];
let index=prizes.findIndex(p=>p.value==prize.value);

currentRotation += 3600 + (360 - (index*60 + 30));
wheel.style.transform=`rotate(${currentRotation}deg)`;

let newPlayers={...data.players};
newPlayers[name]=prize.value;

transaction.update(gameRef,{
players:newPlayers,
budget:data.budget-prize.value,
specialCount:prize.value==500000
? data.specialCount+1
: data.specialCount
});

setTimeout(()=>{
if(prize.value==500000){
alert("ğŸ‰ CHÃšC Má»ªNG "+name+" TRÃšNG 500K ğŸ‰");
}else{
alert(name+" trÃºng "+prize.text);
}
},4000);

});

}catch(err){
alert(err);
}

setTimeout(()=>btn.disabled=false,4000);
}

/* RESET */
async function resetGame(){
const pass=prompt("Nháº­p máº­t kháº©u reset:");
if(pass!==resetPassword){
alert("Sai máº­t kháº©u!");
return;
}

await gameRef.set({
budget:totalBudget,
players:{},
specialCount:0
});

currentRotation=0;
wheel.style.transform="rotate(0deg)";

  // báº­t láº¡i giao diá»‡n  
document.getElementById("qrPanel").style.display = "block";
document.getElementById("fullNotice").style.display = "none";

const spinBtn = document.getElementById("spinBtn");
spinBtn.disabled = false;
spinBtn.innerText = "QUAY NGAY";
spinBtn.style.background = "#00b894";
spinBtn.style.cursor = "pointer";  
fullTriggered = false;  
alert("ÄÃ£ reset game!");
}

/* QR */
new QRCode(document.getElementById("qr"),window.location.href);
</script>

</body>
</html>
