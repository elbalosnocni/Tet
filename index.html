<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Casino Wheel</title>
<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}

canvas{
  margin-top:20px;
}

button{
  margin-top:20px;
  padding:12px 30px;
  font-size:18px;
  background:#f1c40f;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
</style>
</head>
<body>

<h2>ðŸŽ° VÃ²ng quay Casino</h2>
<canvas id="wheel" width="400" height="400"></canvas>
<br>
<button id="spinBtn">QUAY</button>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");

const prizes = ["500k","50k","20k","100k","10k","200k"];
const colors = ["#f39c12","#e74c3c"];

const centerX = 200;
const centerY = 200;
const radius = 180;

let currentAngle = 0;
let spinning = false;

function drawWheel(angle=0){
  const arc = (2*Math.PI)/prizes.length;
  ctx.clearRect(0,0,400,400);

  for(let i=0;i<prizes.length;i++){
    const start = -angle + i*arc;
    const end = start + arc;

    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.arc(centerX,centerY,radius,start,end);
    ctx.fillStyle = colors[i%2];
    ctx.fill();
    ctx.closePath();

    ctx.save();
    ctx.translate(centerX,centerY);
    ctx.rotate(start + arc/2);
    ctx.textAlign="right";
    ctx.fillStyle="#fff";
    ctx.font="bold 20px sans-serif";
    ctx.fillText(prizes[i], radius-50, 5);
    ctx.restore();
  }

  // ===== Pointer outside =====
const pointerHeight = 25;
const pointerWidth = 20;

// vá»‹ trÃ­ Ä‘á»‰nh bÃ¡nh xe
const topY = centerY - radius;

ctx.fillStyle = "#ffffff";
ctx.beginPath();

// Ä‘á»‰nh tam giÃ¡c cháº¡m vÃ o bÃ¡nh xe
ctx.moveTo(centerX, topY - 2);

// Ä‘Ã¡y tam giÃ¡c náº±m phÃ­a trÃªn
ctx.lineTo(centerX - pointerWidth/2, topY - pointerHeight);
ctx.lineTo(centerX + pointerWidth/2, topY - pointerHeight);

ctx.closePath();
ctx.fill();
ctx.strokeStyle = "#f1c40f";
ctx.lineWidth = 3;
ctx.stroke();  
}

drawWheel();

spinBtn.onclick = function(){
  if(spinning) return;

  spinning = true;
  spinBtn.disabled = true;

  const arc = (2*Math.PI)/prizes.length;

  const targetIndex = Math.floor(Math.random()*prizes.length);

  // GÃ³c giá»¯a cá»§a Ã´ trÃºng (theo há»‡ váº½)
  const targetAngle = targetIndex * arc + arc/2;

  // MÅ©i tÃªn á»Ÿ 12h = -PI/2
  const pointerAngle = -Math.PI/2;

  // VÃ¬ drawWheel dÃ¹ng -angle
  // GÃ³c bÃ¡nh xe cáº§n cÃ³ Ä‘á»ƒ target náº±m dÆ°á»›i pointer:
  const absoluteStopAngle = targetAngle - pointerAngle;

  // ThÃªm nhiá»u vÃ²ng quay Ä‘áº¹p
  const spins = Math.PI*2*8;

  // ðŸ‘‰ Quan trá»ng: KHÃ”NG cá»™ng delta phá»©c táº¡p
  const finalAngle = spins + absoluteStopAngle;

  animateSpin(currentAngle, finalAngle, 4000, ()=>{
    currentAngle = finalAngle % (Math.PI*2);

    spinning = false;
    spinBtn.disabled = false;

    alert("ðŸŽ‰ TrÃºng: " + prizes[targetIndex]);
  });
};

function animateSpin(start, end, duration, callback){
  const startTime = performance.now();

  function frame(now){
    const progress = Math.min((now-startTime)/duration,1);
    const ease = 1 - Math.pow(1-progress,4);
    const angle = start + (end-start)*ease;

    drawWheel(angle);

    if(progress<1){
      requestAnimationFrame(frame);
    }else{
      callback();
    }
  }

  requestAnimationFrame(frame);
}
</script>

</body>
</html>
