<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Casino Wheel</title>
<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}

canvas{
  margin-top:20px;
}

button{
  margin-top:20px;
  padding:12px 30px;
  font-size:18px;
  background:#f1c40f;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
</style>
</head>
<body>

<h2>üé∞ V√≤ng quay Casino</h2>
<canvas id="wheel" width="400" height="400"></canvas>
<br>
<button id="spinBtn">QUAY</button>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");

const prizes = [
  "500k",
  "50k",
  "20k",
  "100k",
  "10k",
  "200k"
];

const colors = ["#f39c12","#e74c3c"];
const centerX = 200;
const centerY = 200;
const radius = 180;

let currentAngle = 0;
let spinning = false;

function drawWheel(angle=0){
  const arc = (2*Math.PI)/prizes.length;

  ctx.clearRect(0,0,400,400);

  for(let i=0;i<prizes.length;i++){
    const start = angle + i*arc;
    const end = start + arc;

    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.arc(centerX,centerY,radius,start,end);
    ctx.fillStyle = colors[i%2];
    ctx.fill();
    ctx.closePath();

    ctx.save();
    ctx.translate(centerX,centerY);
    ctx.rotate(start + arc/2);
    ctx.textAlign="right";
    ctx.fillStyle="#fff";
    ctx.font="bold 20px sans-serif";
    ctx.fillText(prizes[i], radius-20, 5);
    ctx.restore();
  }

  // v·∫Ω m≈©i t√™n
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.moveTo(centerX,20);
  ctx.lineTo(centerX-15,60);
  ctx.lineTo(centerX+15,60);
  ctx.fill();
}

drawWheel();

spinBtn.onclick = function(){
  if(spinning) return;

  spinning = true;
  spinBtn.disabled = true;

  const targetIndex = Math.floor(Math.random()*prizes.length);

  const arc = (2*Math.PI)/prizes.length;

  // g√≥c gi·ªØa √¥ tr√∫ng
  const targetAngle = targetIndex*arc + arc/2;

  // m≈©i t√™n ·ªü -90deg (tr√™n c√πng)
  const pointerAngle = -Math.PI/2;

  // t√≠nh g√≥c quay c·∫ßn thi·∫øt
  let rotation = pointerAngle - targetAngle;

  // th√™m nhi·ªÅu v√≤ng quay
  const extra = Math.PI*2*8;

  const finalAngle = currentAngle + extra + rotation;

  animateSpin(currentAngle, finalAngle, 4000, ()=>{
    // Sau khi animation k·∫øt th√∫c
currentAngle = finalAngle % (Math.PI * 2);

// Chu·∫©n h√≥a v·ªÅ 0 ‚Üí 2PI
let normalized = (currentAngle + Math.PI * 2) % (Math.PI * 2);

const arc = (2 * Math.PI) / prizes.length;

// M≈©i t√™n ·ªü -90 ƒë·ªô
const pointer = -Math.PI / 2;

// G√≥c th·ª±c t·∫ø ƒëang ch·ªâ
let resultAngle = pointer - normalized;

// Chu·∫©n h√≥a l·∫°i
resultAngle = (resultAngle + Math.PI * 2) % (Math.PI * 2);

// T√≠nh index ƒë√∫ng
const winningIndex = Math.floor(resultAngle / arc);

alert("üéâ Tr√∫ng: " + prizes[winningIndex]);
}

function animateSpin(start, end, duration, callback){
  const startTime = performance.now();

  function frame(now){
    const progress = Math.min((now-startTime)/duration,1);

    // easing casino m∆∞·ª£t
    const ease = 1 - Math.pow(1-progress,4);

    const angle = start + (end-start)*ease;

    drawWheel(angle);

    if(progress<1){
      requestAnimationFrame(frame);
    }else{
      callback();
    }
  }

  requestAnimationFrame(frame);
}
</script>

</body>
</html>
