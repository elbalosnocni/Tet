<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Táº¾T GIA Tá»˜C Há»Œ TRÆ¯Æ NG 2026</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
text-align:center;
background:linear-gradient(135deg,#a8edea,#fed6e3);
color:#333;
}
h1{margin-top:20px;font-size:32px;}

.panel{
background:white;
padding:15px;
border-radius:15px;
max-width:600px;
margin:15px auto;
box-shadow:0 0 15px rgba(0,0,0,0.1);
}

button{
padding:10px 20px;
font-size:18px;
border:none;
border-radius:10px;
background:#00b894;
color:white;
cursor:pointer;
margin:5px;
}

#wheel{
width:350px;
height:350px;
margin:20px auto;
border-radius:50%;
border:8px solid #f1c40f;
transition: transform 4s cubic-bezier(.17,.67,.83,.67);
position:relative;
overflow:hidden;
}

.segment{
position:absolute;
width:50%;
height:50%;
transform-origin:100% 100%;
left:50%;
top:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
}

.pointer{
position:absolute;
top:180px;
left:50%;
transform:translateX(-50%);
font-size:35px;
}
</style>
</head>

<body>

<h1>ğŸ§§ Táº¾T GIA Tá»˜C Há»Œ TRÆ¯Æ NG 2026 ğŸ§§</h1>

<div class="panel">
ğŸ’° NgÃ¢n sÃ¡ch cÃ²n: <b id="budget">3.000.000</b> Ä‘
<div id="qr"></div>
</div>

<input type="text" id="name" placeholder="Nháº­p tÃªn"><br>
<button onclick="spin()">QUAY NGAY</button>

<div id="wheel"></div>
<div class="pointer">ğŸ”»</div>

<div class="panel">
<h3>ğŸ† Báº£ng xáº¿p háº¡ng</h3>
<div id="ranking"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
apiKey: "AIzaSyAChGYSzBmFDm5QV0y2KvYqAZlt144zZxg",
authDomain: "tet-gia-toc-ho-truong.firebaseapp.com",
projectId: "tet-gia-toc-ho-truong",
storageBucket: "tet-gia-toc-ho-truong.firebasestorage.app",
messagingSenderId: "1035071736410",
appId: "1:1035071736410:web:9beb136d88846bdcbae663",
measurementId: "G-BMWG1JBJMY"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
console.log("Firebase connected");
const prizes=[
{text:"500k",value:500000,limit:1},
{text:"200k",value:200000},
{text:"100k",value:100000},
{text:"50k",value:50000},
{text:"20k",value:20000},
{text:"ChÃºc may máº¯n",value:0}
];

const totalBudget=3000000;
const gameRef=doc(db,"game","main");

async function init(){
const snap=await getDoc(gameRef);
if(!snap.exists()){
await setDoc(gameRef,{
budget:totalBudget,
players:{},
specialCount:0
});
}
}

init();

onSnapshot(gameRef,(docSnap)=>{
const data=docSnap.data();
document.getElementById("budget").innerText=data.budget.toLocaleString();
let rankHTML="";
Object.entries(data.players)
.sort((a,b)=>b[1]-a[1])
.forEach(([name,value])=>{
rankHTML+=`<div>${name}: ${value.toLocaleString()} Ä‘</div>`;
});
document.getElementById("ranking").innerHTML=rankHTML;
});

async function spin(){
const name=document.getElementById("name").value.trim();
if(!name) return alert("Nháº­p tÃªn!");

const snap=await getDoc(gameRef);
const data=snap.data();

if(Object.keys(data.players).length>=10)
return alert("Äá»§ 10 ngÆ°á»i rá»“i!");

if(data.players[name]!==undefined)
return alert("TÃªn Ä‘Ã£ quay!");

let available=prizes.filter(p=>{
if(p.value>data.budget) return false;
if(p.value==500000 && data.specialCount>=1) return false;
return true;
});

let prize=available[Math.floor(Math.random()*available.length)];

let newPlayers=data.players;
newPlayers[name]=prize.value;

await updateDoc(gameRef,{
players:newPlayers,
budget:data.budget-prize.value,
specialCount: prize.value==500000? data.specialCount+1 : data.specialCount
});

alert(name+" trÃºng "+prize.text);
}

new QRCode(document.getElementById("qr"),window.location.href);

window.spin = spin;
</script>

</body>
</html>
